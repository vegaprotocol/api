#!/usr/bin/python3
import jinja2
import os

templ = """\"\"\"
This is the Vega gRPC API client.

Code generated by `generate_init.py`. DO NOT EDIT.
\"\"\"

from .vegatradingclient import VegaTradingClient
from .vegacoreapiclient import VegaCoreAPIClient
from .faucetclient import FaucetClient
from .helpers import grpc_error_detail
from .walletclient import WalletClient
from .generated import (
    api,
    commands,
    coreapi,
    events,
    oracles,
    snapshot,
    tm,
    wallet,
{%- for i in imports %}
    {{ i }},
{%- endfor %}
)

__all__ = [
    "VegaTradingClient",
    "VegaCoreAPIClient",
    "FaucetClient",
    "WalletClient",
    "grpc_error_detail",
    "api",
    "commands",
    "coreapi",
    "events",
    "oracles",
    "snapshot",
    "tm",
    "wallet",
{%- for a in all_list %}
    "{{ a }}",
{%- endfor %}
]
"""


def main():
    p = "vegaapiclient/generated/"
    exclude_pb2 = []
    pb2_files = sorted(
        f[:-7]
        for f in os.listdir(p)
        if os.path.isfile(os.path.join(p, f))
        and f.endswith("_pb2.py")
        and f not in exclude_pb2
    )
    exclude_pb2_grpc = []
    pb2_grpc_files = sorted(
        f[:-12]
        for f in os.listdir(p)
        if os.path.isfile(os.path.join(p, f))
        and f.endswith("_pb2_grpc.py")
        and f not in exclude_pb2_grpc
    )
    imports = sorted(
        [f"{f}_pb2 as {f}" for f in pb2_files]
        + [f"{f}_pb2_grpc as {f}_grpc" for f in pb2_grpc_files]
    )
    all_list = sorted(pb2_files + [f"{f}_grpc" for f in pb2_grpc_files])
    print(
        jinja2.Template(templ).render(
            {"imports": imports, "all_list": all_list}
        )
    )


if __name__ == "__main__":
    main()
